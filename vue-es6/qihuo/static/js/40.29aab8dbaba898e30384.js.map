{"version":3,"sources":["webpack:///src/views/my/accountManage/changePhone.vue","webpack:///./src/views/my/accountManage/changePhone.vue?a3bf","webpack:///./src/views/my/accountManage/changePhone.vue"],"names":["changePhone","name","data","code","phone","showPhone","showPhoneBtn","attcode","showbtn","code_ts","sec","keying","discUrl","inputPhoneError","inputCodeError","watch","value","val","test","this","created","localStorage","getItem","methods","linkHome","$router","go","inputPhone","inputCode","getyzcode","_this","$axios","get","then","res","object","Object","toast","duration","position","message","timer","setInterval","clearInterval","msg","linkNewPassword","that","global","ws","readyState","onopen","onmessage","websocketonmessage","actions","action","reqID","send","stringify_default","e","redata","JSON","parse","success","onClose","Logout","linkLogout","$store","commit","setItem","removeItem","replace","close","accountManage_changePhone","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","title","left-arrow","on","click-left","_v","slot","_s","placeholder","error-message","input","model","callback","$$v","expression","disabled","click","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/40.29aab8dbaba898e30384.js","sourcesContent":["<template>\n  <div class=\"changePassword\">\n    <div class=\"record-bar\">\n      <van-nav-bar\n        title=\"更换手机号\"\n        left-arrow\n        @click-left=\"linkHome\"\n      />\n    </div>\n    <div class=\"title\" >请输入您想要绑定的新手机号,点击获取验证码,您将收到一条附有验证码的短信</div>\n    <div class=\"content\">\n      <van-cell-group>\n        <van-field v-if=\"showPhoneBtn\">\n          <div slot=\"label\" class=\"phone\">\n            <div>手机号：</div>\n            <div>{{showPhone}}</div>\n          </div>\n        </van-field>\n        <van-field v-else v-model=\"phone\" placeholder=\"请输入手机号码\"  :error-message=\"inputPhoneError\" @input=\"inputPhone\">\n        </van-field>\n        <van-field v-model=\"code\" placeholder=\"请输入短信验证码\"  :error-message=\"inputCodeError\" @input=\"inputCode\">\n          <van-button slot=\"button\" class=\"code\" @click=\"getyzcode\" :disabled=\"attcode\" v-if=\"showbtn\">获取验证码</van-button>\n          <van-button slot=\"button\" class=\"code\" v-else>{{code_ts}}</van-button>\n        </van-field>\n      </van-cell-group>\n    </div>\n    <div class=\"button\" @click=\"linkNewPassword\">绑定</div>\n  </div>\n</template>\n\n<script>\n  import { Toast } from 'vant'\n  export default {\n    name: 'changePassword',\n    data () {\n      return {\n        code: '',\n        // 手机号码\n        phone:'',\n        showPhone:'',\n        // 是否来自登录界面\n        showPhoneBtn:false,\n        // 获取验证码\n        attcode: true, // 点击获取验证码按钮判断\n        showbtn: true, // 展示获取验证码或倒计时按钮判断\n        code_ts: '获取验证码', // 倒计时提示文字\n        sec: 60, // 倒计时秒数\n        // 存储验证码返回字段\n        keying: '',\n        // 盘口类型 盘口URL\n        discUrl:'',\n        inputPhoneError:'',\n        inputCodeError:''\n      }\n    },\n    watch: {\n      phone: function (value) {\n        let reg = /\\b1[3456789]\\d{9}\\b/g\n        let val = reg.test(value)\n        if (val) {\n          this.attcode = false\n        } else {\n          this.attcode = true\n        }\n      }\n    },\n    created(){\n      console.log(this.$store.state.environment)\n      console.log(this.$store.state.discUrl)\n      // this.discUrl = '192.168.5.29'\n      this.discUrl = localStorage.getItem('discUrl')\n    },\n    methods: {\n      // 返回上级\n      linkHome () {\n        this.$router.go(-1)\n      },\n      inputPhone(){\n        let value = this.phone\n        let reg = /\\b1[3456789]\\d{9}\\b/g\n        let val = reg.test(value)\n        if (val) {\n          this.inputPhoneError = ''\n        } else {\n          this.inputPhoneError = '手机号格式错误，请重新填写！'\n        }\n      },\n      inputCode(){\n        let value = this.code\n        let reg = /^\\d{5}$/g\n        let val = reg.test(value)\n        console.log(val)\n        if (val) {\n          this.inputCodeError = ''\n        } else {\n          this.inputCodeError = '验证码输入有误，请重新确认！'\n        }\n      },\n      // 获取验证码倒计时\n      getyzcode () {\n        // 短信发送失败，提示手机号已注册\n        this.$axios.get('http://'+this.discUrl+':7777/api/user/smsregister/' + this.phone).then(res => {\n          console.log(res)\n          if (res.data.code === 0  && res.data.object != null) {\n            Toast({\n              duration:1000,\n              position:'bottom',\n              message:'验证码发送成功'\n            })\n            this.keying = res.data.object.keying\n            let timer = setInterval(() => {\n              this.sec = this.sec - 1\n              this.code_ts = this.sec + 'S后重试'\n              this.showbtn = false\n              if (this.sec === 0) {\n                clearInterval(timer)\n                this.sec = 60\n                this.code_ts = this.sec + 'S后重试'\n                this.showbtn = true\n              }\n            }, 1000)\n          }else {\n            Toast({\n              duration:1000,\n              position:'bottom',\n              message:res.data.msg\n            })\n          }\n        })\n      },\n      // 下一步设置新密码\n      linkNewPassword() {\n        let that = this;\n        console.log(that.global.ws)\n        if (that.global.ws && that.global.ws.readyState === 1) {\n          that.global.ws.onopen = that.onopen()\n        }\n        that.global.ws.onmessage = function(res) {\n          that.websocketonmessage (res)\n        };\n      },\n      onopen () { // websocket连接后发送数据(send发送)\n        let actions;\n        let that = this\n        actions = {\n          action: \"updatePhone\",\n          reqID: 88,\n          data: {\n            phone:that.phone,\n            keying:that.keying,\n            code:that.code\n          },\n        }\n        that.global.ws.send(JSON.stringify(actions))\n      },\n      websocketonmessage(e) {\n        let that = this\n        this.redata = JSON.parse(e.data)\n        console.log(this.redata)\n        if(this.redata.action === \"updatePhone\"){\n          if(this.redata.data.code === 0){\n            Toast.success({\n              message:'更换成功',\n              duration:1000,\n              onClose() {\n                that.Logout()\n              }\n            })\n          }else {\n            console.log(this.redata)\n            Toast.success({\n              message:that.redata.data.msg,\n              duration:1000,\n            })\n          }\n        }\n      },\n      linkLogout() {\n        let that = this;\n        // if (that.global.ws && that.global.ws.readyState == 1) {\n        //   that.global.ws.onopen = that.onopen2()\n        // }\n        // that.global.ws.onmessage = function(res) {\n        //   that.websocketonmessage2 (res)\n        // };\n        this.$store.commit('userStatus','false')\n        localStorage.setItem('discUrl', '121.43.137.150')\n        localStorage.removeItem('Flag')\n        localStorage.removeItem('name')\n        localStorage.removeItem('account')\n        localStorage.removeItem('uid')\n        localStorage.removeItem('status')\n        localStorage.removeItem('phone')\n        localStorage.removeItem('disc')\n        localStorage.removeItem('idcard')\n        localStorage.removeItem('idcardtype')\n        localStorage.removeItem('bank')\n        localStorage.removeItem('bankAccount')\n        localStorage.removeItem('isDrawPass')\n        localStorage.removeItem('token')\n        localStorage.removeItem('upTitle')\n        localStorage.removeItem('positionid')\n        localStorage.removeItem('LoginCode')\n        localStorage.removeItem('LoginKeying')\n        localStorage.removeItem('LoginPassword')\n        localStorage.removeItem('LoginMode')\n        localStorage.removeItem('environment')\n        Toast({\n          position:'bottom',\n          message:'退出登录成功',\n          duration:1000\n        })\n        that.$router.replace('/')\n        // console.log(that.global.ws)\n        that.global.ws.close()\n      },\n    }\n  }\n</script>\n\n<style scoped lang=\"scss\">\n  @import \"../../../style/my\";\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/views/my/accountManage/changePhone.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"changePassword\"},[_c('div',{staticClass:\"record-bar\"},[_c('van-nav-bar',{attrs:{\"title\":\"更换手机号\",\"left-arrow\":\"\"},on:{\"click-left\":_vm.linkHome}})],1),_vm._v(\" \"),_c('div',{staticClass:\"title\"},[_vm._v(\"请输入您想要绑定的新手机号,点击获取验证码,您将收到一条附有验证码的短信\")]),_vm._v(\" \"),_c('div',{staticClass:\"content\"},[_c('van-cell-group',[(_vm.showPhoneBtn)?_c('van-field',[_c('div',{staticClass:\"phone\",attrs:{\"slot\":\"label\"},slot:\"label\"},[_c('div',[_vm._v(\"手机号：\")]),_vm._v(\" \"),_c('div',[_vm._v(_vm._s(_vm.showPhone))])])]):_c('van-field',{attrs:{\"placeholder\":\"请输入手机号码\",\"error-message\":_vm.inputPhoneError},on:{\"input\":_vm.inputPhone},model:{value:(_vm.phone),callback:function ($$v) {_vm.phone=$$v},expression:\"phone\"}}),_vm._v(\" \"),_c('van-field',{attrs:{\"placeholder\":\"请输入短信验证码\",\"error-message\":_vm.inputCodeError},on:{\"input\":_vm.inputCode},model:{value:(_vm.code),callback:function ($$v) {_vm.code=$$v},expression:\"code\"}},[(_vm.showbtn)?_c('van-button',{staticClass:\"code\",attrs:{\"slot\":\"button\",\"disabled\":_vm.attcode},on:{\"click\":_vm.getyzcode},slot:\"button\"},[_vm._v(\"获取验证码\")]):_c('van-button',{staticClass:\"code\",attrs:{\"slot\":\"button\"},slot:\"button\"},[_vm._v(_vm._s(_vm.code_ts))])],1)],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"button\",on:{\"click\":_vm.linkNewPassword}},[_vm._v(\"绑定\")])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-74899c37\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/my/accountManage/changePhone.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-74899c37\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./changePhone.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./changePhone.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./changePhone.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-74899c37\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./changePhone.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-74899c37\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/my/accountManage/changePhone.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}